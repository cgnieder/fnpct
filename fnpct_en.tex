% --------------------------------------------------------------------------
% the FNPCT package v0.1alpha
% 
%   footnote kerning
% 
% 2012/05/19
% --------------------------------------------------------------------------
% Clemens Niederberger
% Web:    https://bitbucket.org/cgnieder/fnpct/
% E-Mail: contact@mychemistry.eu
% --------------------------------------------------------------------------
% Copyright 2012 Clemens Niederberger
% 
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
% 
% This work has the LPPL maintenance status `maintained'.
% 
% The Current Maintainer of this work is Clemens Niederberger.
% --------------------------------------------------------------------------
% The fnpct package consists of the files
%  - fnpct.sty,
%  - README
% --------------------------------------------------------------------------
% If you have any ideas, questions, suggestions or bugs to report, please
% feel free to contact me.
% --------------------------------------------------------------------------
% the package is inspired by the following question on TeX.SE:
%   http://tex.stackexchange.com/q/56094/5049
% --------------------------------------------------------------------------
% if you want to compile this documentation you'll need the document class
% `cnpkgdoc' which you can get here:
%    https://bitbucket.org/cgnieder/cnpkgdoc/
%    the class is licensed LPPL 1.3 or later
\documentclass[toc=index,toc=bib]{cnpkgdoc}
\docsetup{
  pkg      = fnpct ,
  code-box = {
    skipbelow = .5\baselineskip ,
    skipabove = .5\baselineskip ,
  }
}
\addcmds{
  arabic,
  DeclareNewFootnote,
  endnote,
  footnoteB,
  kfc,
  kfp,
  multendnote,
  multfootnote,
  multparnote,
  parnote,
  parnotes,
  setfnpct,
  theendnotes,
  thempfootnote
}
\setfnpct{multiple}
\usepackage{endnotes}
\usepackage{parnotes}

\renewcommand\thempfootnote{\arabic{mpfootnote}}

\usepackage[backend=biber]{biblatex}
\addbibresource{biblatex-examples.bib}
\addbibresource{\jobname.bib}

\begin{filecontents}{\jobname.bib}
@software{bigfoot,
  title   = {bigfoot},
  author  = {David Kastrup},
  date    = {2006/07/15},
  version = {1.25},
  url     = {http://www.ctan.org/pkg/bigfoot}
}
@software{endnotes,
  title   = {endnotes},
  author  = {Robin Fairbairns},
  date    = {2012/01/15},
  url     = {http://www.ctan.org/pkg/endnotes}
}
@software{footmisc,
  title   = {footmisc},
  author  = {Robin Fairbairns},
  date    = {2011/06/06},
  version = {5.5b},
  url     = {http://www.ctan.org/pkg/footmisc}
}
@software{manyfoot,
  title   = {manyfoot},
  author  = {Alexander I. Rozhenko},
  date    = {2005/09/11},
  version = {1.10},
  url     = {http://www.ctan.org/pkg/manyfoot}
}
@software{parnotes,
  title   = {parnotes},
  author  = {Micheal Hughes},
  date    = {2012/03/01},
  version = {1},
  url     = {http://www.ctan.org/pkg/parnotes}
}
\end{filecontents}

\begin{filecontents}{\jobname.ist}
 preamble "\\begin{theindex}\n Section titles are indicated \\textbf{bold},
 packages \\textsf{sans serif}, commands \\code{\\textbackslash\\textcolor{code}{brown}}
 and options \\textcolor{key}{\\code{green}}.\\newline\n\n"
 heading_prefix "{\\bfseries "
 heading_suffix "\\hfil}\\nopagebreak\n"
 headings_flag  1
 delim_0 "\\dotfill "
 delim_1 "\\dotfill "
 delim_2 "\\dotfill "
 delim_r "\\textendash"
 suffix_2p "\\nohyperpage{\\,f.}"
 suffix_3p "\\nohyperpage{\\,ff.}"
\end{filecontents}

\makeindex
\begin{document}

\section{License and Requirements}
\fnpct is placed under the terms of the LaTeX Project Public License,
version 1.3 or later (\url{http://www.latex-project.org/lppl.txt}).
It has the status \enquote{maintained}.

\fnpct depends on the \paket{l3kernel} and \paket*{xparse} which is part of the
\paket{l3packages} bundle.

\newpage
\section{What's it all about?}
\subsection{Basics}\secidx{basics}
The \fnpct package basically does two things to footnotes: if footnote marks are
followed by a comma or a dot the order of footnote and punctuation mark is reversed
and the kerning gets adjusted.

All examples in this documentation use
\begin{beispiel}[code only]
 \renewcommand\thempfootnote{\arabic{mpfootnote}}
\end{beispiel}

Now, let's see some action:
\begin{beispiel}
 \begin{minipage}{.4\linewidth}
  \noindent The three little pigs built their houses
  out of straw\footnote{not to be confused with hay},
  sticks\footnote{or lumber according to some sources}
  and bricks\footnote{probably fired clay bricks}.
 \end{minipage}
\end{beispiel}

To ensure that the kerning is set the right way the footnote \emph{must} be placed
\emph{before} the dot or the comma. The command can look ahead but not look back.
This means if you place the \cmd{footnote} command after a dot or a comma it is
treated as if following a word, \ie a thin space is inserted: effectivly the opposite 
of the desired behaviour.

The order-switching can be prevented using a package option since not all countries
and languages have the same typographic conventions.
\begin{beschreibung}
 \option{punct-after}{\default{true}/false} when \code{true} the punctuation sign
 will be placed \emph{after} the footnote.
\end{beschreibung}
which like all options can also be set using the setup command.
\begin{beschreibung}
 \befehl{setfnpct}{<options>} set up options. Can be used anywhere in the document.
 Some options can only be set in the preamble, though.
\end{beschreibung}
\begin{beispiel}
 \setfnpct{punct-after}
 \begin{minipage}{.4\linewidth}
  \noindent The three little pigs built their houses
  out of straw\footnote{not to be confused with hay},
  sticks\footnote{or lumber according to some sources}
  and bricks\footnote{probably fired clay bricks}.
 \end{minipage}
\end{beispiel}
\secidx*{basics}

\subsection{Temporarily disable switching}\secidx{disable switching}
One maybe want to put some footnote marks \emph{before} the punctuation and some
after, for example because the first one describes a single word but the second
one a whole sentence. For this purpose \fnpct adds a \code{*} argument to \cmd{footnote}
and \cmd{footnotemark}:
\begin{beschreibung}
 \befehl[footnotea]{footnote}*[<num>]{<footnote text>} new \code{*} argument added.
 \befehl[footnotemarka]{footnotemark}*[<num>] new \code{*} argument added.
\end{beschreibung}
This argument temporarily turns off the punctuation/footnote switching.
\begin{beispiel}
 \begin{minipage}{.4\linewidth}
  \noindent The three little pigs built their houses
  out of straw\footnote*{not to be confused with hay},
  sticks\footnote{or lumber according to some sources}
  and bricks\footnote{probably fired clay bricks}.
 \end{minipage}
\end{beispiel}

\achtung{Please be aware that this package is in an experimental state and there
hasn't been extensive testing with other footnote behaviour changing packages!}
\secidx*{disable switching}

\section{Options}\secidx{options}
All package options are listed below. They all can be set as a package option or
with the \cmd{setfnpct} command. Most of them are for adjusting the kerning.
\begin{beschreibung}
 \option{after-dot-space}{<dim>} space to be inserted after a dot and before the
 footnote mark. Default = \code{-.06em}
 \option{after-comma-space}{<dim>} space to be inserted after a comma and before
 the footnote mark. Default = \code{-.06em}
 \option{after-punct-space}{<dim>} set both spaces.
 \option{punct-after}{\default{true}/false} when \code{true} the punctuation sign
 will be placed \emph{after} the footnote.
 \option{before-dot-space}{<dim>} space to be inserted before a dot and after the
 footnote mark, \ie with \key{punct-after}{true}. Default = \code{-.15em}
 \option{before-comma-space}{<dim>} space to be inserted before a comma and after
 the footnote mark, \ie with \key{punct-after}{true}. Default = \code{-.15em}
 \option{before-punct-space}{<dim>} set both spaces.
 \option{before-footnote-space}{<dim>} space to be inserted between a word and the
 following footnote mark. Default = \code{.06em}
 \option{multiple}{\default{true}/false} lets \cmd{footnote} be equal to
 \cmd{multfootnote}
 \option{mult-fn-delim}{<delimiter>} sets the delimiter for the \cmd{multfootnote}
 command.
 \option{mult-fn-sep}{<separator>} sets the separator between multiple footnote
 marks.
\end{beschreibung}

Let's take a look at an example with some ridiculous settings:
\begin{beispiel}
 % some ridiculous settings:
 \setfnpct{after-punct-space=2pt,before-footnote-space=2pt}
 \begin{minipage}{.4\linewidth}
  \noindent The three little pigs built their houses
  out of straw\footnote{not to be confused with hay},
  sticks\footnote{or lumber according to some sources}
  and bricks\footnote{probably fired clay bricks}.
 \end{minipage}
\end{beispiel}

And now the same with switched order:
\begin{beispiel}
 % some ridiculous settings:
 \setfnpct{punct-after,before-punct-space=2pt,before-footnote-space=2pt}
 \begin{minipage}{.4\linewidth}
  \noindent The three little pigs built their houses
  out of straw\footnote{not to be confused with hay},
  sticks\footnote{or lumber according to some sources}
  and bricks\footnote{probably fired clay bricks}.
 \end{minipage}
\end{beispiel}

Some of the options are explained in a bit more detail in the next sections.
\secidx*{options}

\section{Multiple footnotes}\secidx{multiple footnotes}
\subsection{Basics}\secidx[basics]{multiple footnotes}
Since multiple footnotes have to be treated differently\footnote{see these footnotes;for an example},
\fnpct provides an extra command for that:
\begin{beschreibung}
 \befehl{multfootnote}*{<list>;<of>;<footnotes>} different footnotes are separated
 with a semicolon. The \code{*} turns the footnote/punctuation switching temporarily
 off.
\end{beschreibung}
\begin{beispiel}
 \begin{minipage}{.4\linewidth}
  \noindent The three little pigs built their houses
  out of straw\footnote{not to be confused with hay},
  sticks\footnote{or lumber according to some sources}
  and bricks\multfootnote{probably fired clay bricks;or
  something else}.
 \end{minipage}
\end{beispiel}

Every of the items of the list has an optional argument equivalent to the optional
argument of \cmd{footnote}:
\begin{beispiel}
 \begin{minipage}{.4\linewidth}
  \noindent The three little pigs built their houses
  out of straw\footnote{not to be confused with hay},
  sticks\footnote{or lumber according to some sources}
  and bricks\multfootnote{probably fired clay bricks;[5]or
  something else}.
 \end{minipage}
\end{beispiel}

\subsection{The delimiter and separator}\secidx[delimiter]{multiple footnotes}\secidx[separator]{multiple footnotes}
Since the semicolon might be part of the footnote text you might have some trouble.
But there are ways around. Maybe try enclosing it with braces:
\begin{beispiel}
 \begin{minipage}{.4\linewidth}
  \noindent The three little pigs built their houses
  out of straw\footnote{not to be confused with hay},
  sticks\footnote{or lumber according to some sources}
  and bricks\multfootnote{probably fired clay bricks{;}
  or something else;what do I know}.
 \end{minipage}
\end{beispiel}

There are options which lets you choose the (input) delimiter and the (output)
separator:
\begin{beschreibung}
 \option{mult-fn-delim}{<delimiter>} choose delimiter for the \cmd{multfootnote}.
 Default = \code{;}
 \option{mult-fn-sep}{<separator>} choose the separator that is put between footnote
 marks. Default = \code{,}
\end{beschreibung}
\begin{beispiel}
 \setfnpct{mult-fn-delim=//,mult-fn-sep=;}
 \begin{minipage}[t]{.4\linewidth}
  \noindent The three little pigs built their houses
  out of straw\footnote{not to be confused with hay},
  sticks\footnote{or lumber according to some sources}
  and bricks\multfootnote{probably fired clay bricks;
  or something else//what do I know}.
 \end{minipage}\hfil
 \setfnpct{mult-fn-delim=;,mult-fn-sep=}
 \renewcommand*\thempfootnote{\fnsymbol{mpfootnote}}
 \begin{minipage}[t]{.4\linewidth}
  \noindent The three little pigs built their houses
  out of straw\footnote{not to be confused with hay},
  sticks\footnote{or lumber according to some sources}
  and bricks\multfootnote{probably fired clay bricks;
  or something else}.
 \end{minipage}
\end{beispiel}

\subsection{Automagic}\secidx[automagic]{multiple footnotes}
If you want you can turn all footnotes into \cmd{multfootnote}s.
\begin{beschreibung}
 \option{multiple}{\default{true}/false} let \cmd{footnote} behave like \cmd{multfootnote}.
 \emph{This option can only be set in the preamble}. Default = \code{false}
\end{beschreibung}
\begin{beispiel}
 % in preamble: \setfnpct{multiple}
 % or \usepackage[multiple]{fnpct}
 \begin{minipage}{.4\linewidth}
  \noindent The three little pigs built their houses
  out of straw\footnote{not to be confused with hay},
  sticks\footnote{or lumber according to some sources}
  and bricks\footnote{probably fired clay bricks;or
  something else}.
 \end{minipage}
\end{beispiel}
\secidx*{multiple footnotes}

\section{Footcites}\secidx{footcites}
Preliminary testing suggests that \fnpct seems to be compatible with the
\cmd{footcite} and \cmd{footfullcite} commands provided by the \paket{biblatex}
package. However, the punctuation switching does not apply to them.

The kerning works \ldots
\begin{beispiel}
 \setfnpct{before-footnote-space=2pt}
 \begin{minipage}{.5\linewidth}
  \noindent The three little pigs built their houses
  out of straw\footnote{not to be confused with hay},
  sticks\footnote{or lumber according to some sources}
  and bricks\footnote{probably fired clay bricks}. The
  companion\footfullcite{companion} has nothing on this
  topic.
 \end{minipage}
\end{beispiel}

\ldots\ but the punctuation switching doesn't:
\begin{beispiel}
 \begin{minipage}{.5\linewidth}
  \noindent The three little pigs built their houses
  out of straw\footnote{not to be confused with hay},
  sticks\footnote{or lumber according to some sources}
  and bricks\footnote{probably fired clay bricks}. The
  companion has nothing on this topic\footfullcite{companion}.
 \end{minipage}
\end{beispiel}

One can simulate that behaviour by actively setting one of these commands:
\begin{beschreibung}
 \befehl{kfp} insert the \key{after-dot-space} or (if \key{punct-after}{true})
 the \key{before-dot-space}.
 \befehl{kfc} insert the \key{after-comma-space} or (if \key{punct-after}{true})
 the \key{before-comma-space}.
\end{beschreibung}
\begin{beispiel}
 \setfnpct{after-punct-space=-.15em}
 \begin{minipage}{.5\linewidth}
  \noindent The three little pigs built their houses
  out of straw\footnote{not to be confused with hay},
  sticks\footnote{or lumber according to some sources}
  and bricks\footnote{probably fired clay bricks}. The
  companion has nothing on this topic.\kfp\footfullcite{companion}
 \end{minipage}
\end{beispiel}

In case of \key{punct-after}{true}:
\begin{beispiel}
 \setfnpct{punct-after}
 \begin{minipage}{.5\linewidth}
  \noindent The three little pigs built their houses
  out of straw\footnote{not to be confused with hay},
  sticks\footnote{or lumber according to some sources}
  and bricks\footnote{probably fired clay bricks}. The
  companion has nothing on this topic\footfullcite{companion}\kfp.
 \end{minipage}
\end{beispiel}
\secidx*{footcites}

\section{Other packages}

\subsection{bigfoot}\label{ssec:bigfoot}
\fnpct is compatible with the \paket{bigfoot} \cite{bigfoot} package. You need to
a bit cautious, though. You'll need to
\begin{itemize}
 \item load \paket{bigfoot} first;
 \item declare footnotes with \cmd{DeclareNewFootnote} \emph{after} loading \fnpct
 but \emph{in} the document preamble.
\end{itemize}
Also verbatim material won't work inside footnotes anymore. Since \fnpct does not
redefine any \cmd{footnotetext} like command it will still work inside one of them.

For every footnote class defined with \cmd{DeclareNewFootnote} the commands
\cmd{footnote<class>} and \cmd{footnotemark<class>} are redefined with the starred
variant and a \cmd{multfootnote<class>} is defined. The \key{multiple} option
will turn all \cmd{footnote<class>} commands into the corresponding
\cmd{multfootnote<class>}.

\fnpct has an additional package option which \emph{cannot} be set with \cmd{setfnpct}
and only has any effects if \paket{bigfoot} has been loaded:
\begin{beschreibung}
 \option{bigfoot-default-top}{\default{true}/false} sets the \code{default} footnote
 class as top layer. Default = \code{false}
\end{beschreibung}

Since this package cannot easily combine every footnote package for demonstration
purposes the following code is shown in figure \ref{fig:bigfoot}:
\begin{beispiel}[code only]
\documentclass{article}
\usepackage[
  paperwidth=.5\textwidth,
  paperheight=12\baselineskip,
  margin=5pt,
  bottom=1.5cm]{geometry}

\usepackage{bigfoot}
\usepackage[bigfoot-default-top]{fnpct}
\setfnpct{multiple}
\DeclareNewFootnote[para]{B}[alph]

\begin{document}

\noindent The three little pigs built their houses
out of straw\footnote*{not to be confused with hay%
\footnoteB{let alone grass}}, sticks\footnote{or
lumber according to some sources} and bricks%
\footnote{probably fired clay bricks;or something}.

\end{document}
\end{beispiel}

\begin{figure}[ht]
 \centering
 \includegraphics{bigfoot_ex.pdf}
 \caption{\paket*{bigfoot} example}
 \label{fig:bigfoot}
\end{figure}


\subsection{endnotes}\secidx{endnotes}
The \paket{endnotes} \cite{endnotes} package povides the commands \cmd{endnote} and \cmd{endnotemark}
which can be used to output all notes at the end of a chapter, say.

If the package is loaded \fnpct extends its functionality to these commands in
the same way it does with footnotes. For example an according \cmd{multendnote}
is defined. With the package option \key{multiple} all \cmd{endnote}s are turned
into \cmd{multendnote}s.
\begin{beispiel}
 \begin{minipage}[t]{.4\linewidth}
  \noindent The three little pigs built their houses
  out of straw\endnote{not to be confused with hay},
  sticks\endnote{or lumber according to some sources}
  and bricks\endnote{probably fired clay bricks}.
  
  \theendnotes
 \end{minipage}\hfil
 \begin{minipage}[t]{.4\linewidth}
  \noindent The three little pigs built their houses
  out of straw\endnote*{not to be confused with hay},
  sticks\endnote{or lumber according to some sources}
  and bricks\multendnote{probably fired clay bricks;or
  something else}.
  
  \theendnotes
 \end{minipage}
\end{beispiel}
\secidx*{endnotes}

\subsection{footmisc}
Testing showed no incompatibilities with the \paket{footmisc} package \cite{footmisc}.
The only thing is that you won't have to use its \code{multiple} option.

\subsection{manyfoot}
The \paket{manyfoot} package \cite{manyfoot} is not and will not be supported. It
is loaded by \paket{bigfoot} (see section \ref{ssec:bigfoot}), anyway.

\subsection{parnotes}\secidx{parnotes}
The \paket{parnotes} package \cite{parnotes} does something similar to the \paket{endnotes}
package. If \paket{parnotes} is loaded \fnpct extends its functionality analogous
to the one of \paket{endnotes}.

Again the \key{multiple} option turns all \cmd{parnote}s into \cmd{multparnote}s.
\begin{beispiel}
 \begin{minipage}[t]{.4\linewidth}
  \noindent The three little pigs built their houses
  out of straw\parnote{not to be confused with hay},
  sticks\parnote{or lumber according to some sources}
  and bricks\parnote{probably fired clay bricks}.
  
  \parnotes
 \end{minipage}\hfil
 \begin{minipage}[t]{.4\linewidth}
  \noindent The three little pigs built their houses
  out of straw\parnote*{not to be confused with hay},
  sticks\parnote{or lumber according to some sources}
  and bricks\multparnote{probably fired clay bricks;or
  something else}.
  
  \parnotes
 \end{minipage}
\end{beispiel}

\secidx*{parnotes}

\appendix
\printbibliography
\printindex
\end{document}